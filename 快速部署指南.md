# è‹¥ä¾åª’ä½“ç®¡ç†ç³»ç»Ÿ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“åˆå§‹åŒ–

```sql
-- 1. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE ry CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 2. ä½¿ç”¨æ•°æ®åº“
USE ry;

-- 3. å¯¼å…¥åŸºç¡€æ•°æ®
source sql/ry_20250522.sql;
source sql/quartz.sql;

-- 4. å¯¼å…¥åª’ä½“ç®¡ç†æ‰©å±•
source sql/media_tables.sql;
source sql/media_menu.sql;
```

### 2. é…ç½®æ–‡ä»¶ä¿®æ”¹

ç¼–è¾‘ `ruoyi-admin/src/main/resources/application-druid.yml`ï¼š

```yaml
spring:
  datasource:
    druid:
      master:
        url: jdbc:mysql://localhost:3306/ry?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
        username: root
        password: ä½ çš„æ•°æ®åº“å¯†ç 
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# æ–¹å¼1ï¼šç›´æ¥è¿è¡ŒjaråŒ…
java -jar ruoyi-admin/target/ruoyi-admin.jar

# æ–¹å¼2ï¼šä½¿ç”¨Mavenè¿è¡Œ
mvn spring-boot:run -pl ruoyi-admin
```

### 4. å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆå¯é€‰ï¼‰

```bash
cd ruoyi-ui
npm install
npm run dev
```

## ğŸ“± iOSåº”ç”¨APIæ¥å£

### åŸºç¡€URL
```
http://localhost:8080/api/media
```

### ä¸»è¦æ¥å£

#### 1. è·å–å…¬å¼€åª’ä½“åˆ—è¡¨
```http
GET /api/media/public/list?fileType=video&pageNum=1&pageSize=10
```

#### 2. è·å–åª’ä½“è¯¦æƒ…
```http
GET /api/media/public/{fileId}
```

#### 3. ä¸Šä¼ åª’ä½“æ–‡ä»¶
```http
POST /api/media/upload
Content-Type: multipart/form-data

file: [åª’ä½“æ–‡ä»¶]
title: "è§†é¢‘æ ‡é¢˜"
description: "è§†é¢‘æè¿°"
categoryId: 1
tags: "æ ‡ç­¾1,æ ‡ç­¾2"
```

#### 4. æ’­æ”¾åª’ä½“ï¼ˆç»Ÿè®¡æ’­æ”¾æ¬¡æ•°ï¼‰
```http
POST /api/media/play/{fileId}?deviceId=iOS_Device_123
```

#### 5. ç‚¹èµåª’ä½“
```http
POST /api/media/like/{fileId}
```

#### 6. æŒ‰åˆ†ç±»è·å–åª’ä½“
```http
GET /api/media/category/{categoryId}
```

#### 7. è·å–çƒ­é—¨åª’ä½“
```http
GET /api/media/hot?fileType=video&limit=20
```

#### 8. æœç´¢åª’ä½“
```http
GET /api/media/search?keyword=å…³é”®è¯&fileType=video
```

## ğŸ”§ ç®¡ç†åå°

### è®¿é—®åœ°å€
```
http://localhost:8080
```

### é»˜è®¤è´¦å·
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

### åª’ä½“ç®¡ç†åŠŸèƒ½
1. **åª’ä½“æ–‡ä»¶ç®¡ç†** - `/media/file`
   - æ–‡ä»¶ä¸Šä¼ ã€ç¼–è¾‘ã€åˆ é™¤
   - æ’­æ”¾ç»Ÿè®¡æŸ¥çœ‹
   - çŠ¶æ€ç®¡ç†

2. **åª’ä½“åˆ†ç±»ç®¡ç†** - `/media/category`
   - åˆ†ç±»åˆ›å»ºã€ç¼–è¾‘
   - æ ‘å½¢ç»“æ„ç®¡ç†

3. **æ’­æ”¾ç»Ÿè®¡** - `/media/statistics`
   - æ’­æ”¾æ•°æ®åˆ†æ
   - ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡

## ğŸ“ æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

### éŸ³é¢‘æ ¼å¼
- mp3, wav, wma, aac, flac, ogg, m4a

### è§†é¢‘æ ¼å¼
- mp4, avi, rmvb, wmv, mov, flv, mkv, webm, m4v

## âš™ï¸ é…ç½®è¯´æ˜

### æ–‡ä»¶ä¸Šä¼ é…ç½®

åœ¨ `application.yml` ä¸­ï¼š

```yaml
ruoyi:
  # æ–‡ä»¶ä¸Šä¼ è·¯å¾„
  profile: ./uploadPath

spring:
  servlet:
    multipart:
      # å•ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶
      max-file-size: 100MB
      # æ€»ä¸Šä¼ å¤§å°é™åˆ¶
      max-request-size: 100MB
```

### åª’ä½“æ–‡ä»¶è®¿é—®

ä¸Šä¼ çš„åª’ä½“æ–‡ä»¶å¯é€šè¿‡ä»¥ä¸‹URLè®¿é—®ï¼š
```
http://localhost:8080/profile/media/2025/01/01/æ–‡ä»¶å.mp4
```

## ğŸ”’ å®‰å…¨é…ç½®

### APIæ¥å£å®‰å…¨

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ï¼š

1. **ä¸Šä¼ æ¥å£è®¤è¯**ï¼šä¸º `/api/media/upload` æ·»åŠ è®¤è¯
2. **è®¿é—®é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢æ¶æ„è¯·æ±‚
3. **æ–‡ä»¶ç±»å‹éªŒè¯**ï¼šä¸¥æ ¼éªŒè¯ä¸Šä¼ æ–‡ä»¶ç±»å‹
4. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šæ ¹æ®éœ€æ±‚è°ƒæ•´æ–‡ä»¶å¤§å°é™åˆ¶

### ç¤ºä¾‹ï¼šæ·»åŠ ä¸Šä¼ è®¤è¯

```java
@PostMapping("/upload")
@PreAuthorize("hasRole('USER')") // éœ€è¦ç”¨æˆ·è§’è‰²
public AjaxResult uploadMedia(...) {
    // ä¸Šä¼ é€»è¾‘
}
```

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
- ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
- æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
- ç¡®è®¤æ–‡ä»¶å¤§å°é™åˆ¶
- éªŒè¯æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ

### 3. è·¨åŸŸé—®é¢˜
- å‰ç«¯å¼€å‘æ—¶å¯èƒ½é‡åˆ°è·¨åŸŸé—®é¢˜
- å¯åœ¨ `application.yml` ä¸­é…ç½®CORS

```yaml
spring:
  web:
    cors:
      allowed-origins: "*"
      allowed-methods: "*"
      allowed-headers: "*"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–
- ä½¿ç”¨CDNåŠ é€Ÿåª’ä½“æ–‡ä»¶è®¿é—®
- è€ƒè™‘ä½¿ç”¨äº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSï¼‰
- å®šæœŸæ¸…ç†æ— ç”¨æ–‡ä»¶

### 2. æ•°æ®åº“ä¼˜åŒ–
- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- å®šæœŸæ¸…ç†æ’­æ”¾è®°å½•ç­‰æ—¥å¿—æ•°æ®
- è€ƒè™‘è¯»å†™åˆ†ç¦»

### 3. ç¼“å­˜ä¼˜åŒ–
- çƒ­é—¨åª’ä½“åˆ—è¡¨ç¼“å­˜
- åˆ†ç±»ä¿¡æ¯ç¼“å­˜
- ç”¨æˆ·æ’­æ”¾å†å²ç¼“å­˜

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`logs/sys-info.log`
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œè¡¨ç»“æ„
3. å‚è€ƒè‹¥ä¾å®˜æ–¹æ–‡æ¡£ï¼šhttp://doc.ruoyi.vip

---

**éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„iOSåº”ç”¨å°±å¯ä»¥é€šè¿‡è¿™äº›APIæ¥å£è¿›è¡ŒéŸ³è§†é¢‘å†…å®¹çš„ç®¡ç†å’Œå±•ç¤ºäº†ï¼** ğŸ‰