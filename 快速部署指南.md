# 若依媒体管理系统 - 快速部署指南

## 🚀 快速开始

### 1. 数据库初始化

```sql
-- 1. 创建数据库
CREATE DATABASE ry CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 2. 使用数据库
USE ry;

-- 3. 导入基础数据
source sql/ry_20250522.sql;
source sql/quartz.sql;

-- 4. 导入媒体管理扩展
source sql/media_tables.sql;
source sql/media_menu.sql;
```

### 2. 配置文件修改

编辑 `ruoyi-admin/src/main/resources/application-druid.yml`：

```yaml
spring:
  datasource:
    druid:
      master:
        url: jdbc:mysql://localhost:3306/ry?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
        username: root
        password: 你的数据库密码
```

### 3. 启动后端服务

```bash
# 方式1：直接运行jar包
java -jar ruoyi-admin/target/ruoyi-admin.jar

# 方式2：使用Maven运行
mvn spring-boot:run -pl ruoyi-admin
```

### 4. 启动前端服务（可选）

```bash
cd ruoyi-ui
npm install
npm run dev
```

## 📱 iOS应用API接口

### 基础URL
```
http://localhost:8080/api/media
```

### 主要接口

#### 1. 获取公开媒体列表
```http
GET /api/media/public/list?fileType=video&pageNum=1&pageSize=10
```

#### 2. 获取媒体详情
```http
GET /api/media/public/{fileId}
```

#### 3. 上传媒体文件
```http
POST /api/media/upload
Content-Type: multipart/form-data

file: [媒体文件]
title: "视频标题"
description: "视频描述"
categoryId: 1
tags: "标签1,标签2"
```

#### 4. 播放媒体（统计播放次数）
```http
POST /api/media/play/{fileId}?deviceId=iOS_Device_123
```

#### 5. 点赞媒体
```http
POST /api/media/like/{fileId}
```

#### 6. 按分类获取媒体
```http
GET /api/media/category/{categoryId}
```

#### 7. 获取热门媒体
```http
GET /api/media/hot?fileType=video&limit=20
```

#### 8. 搜索媒体
```http
GET /api/media/search?keyword=关键词&fileType=video
```

## 🔧 管理后台

### 访问地址
```
http://localhost:8080
```

### 默认账号
- 用户名：`admin`
- 密码：`admin123`

### 媒体管理功能
1. **媒体文件管理** - `/media/file`
   - 文件上传、编辑、删除
   - 播放统计查看
   - 状态管理

2. **媒体分类管理** - `/media/category`
   - 分类创建、编辑
   - 树形结构管理

3. **播放统计** - `/media/statistics`
   - 播放数据分析
   - 用户行为统计

## 📁 支持的文件格式

### 音频格式
- mp3, wav, wma, aac, flac, ogg, m4a

### 视频格式
- mp4, avi, rmvb, wmv, mov, flv, mkv, webm, m4v

## ⚙️ 配置说明

### 文件上传配置

在 `application.yml` 中：

```yaml
ruoyi:
  # 文件上传路径
  profile: ./uploadPath

spring:
  servlet:
    multipart:
      # 单个文件大小限制
      max-file-size: 100MB
      # 总上传大小限制
      max-request-size: 100MB
```

### 媒体文件访问

上传的媒体文件可通过以下URL访问：
```
http://localhost:8080/profile/media/2025/01/01/文件名.mp4
```

## 🔒 安全配置

### API接口安全

对于生产环境，建议：

1. **上传接口认证**：为 `/api/media/upload` 添加认证
2. **访问频率限制**：防止恶意请求
3. **文件类型验证**：严格验证上传文件类型
4. **文件大小限制**：根据需求调整文件大小限制

### 示例：添加上传认证

```java
@PostMapping("/upload")
@PreAuthorize("hasRole('USER')") // 需要用户角色
public AjaxResult uploadMedia(...) {
    // 上传逻辑
}
```

## 🚨 常见问题

### 1. 数据库连接失败
- 检查数据库服务是否启动
- 确认数据库连接配置正确
- 检查防火墙设置

### 2. 文件上传失败
- 检查上传目录权限
- 确认文件大小限制
- 验证文件格式是否支持

### 3. 跨域问题
- 前端开发时可能遇到跨域问题
- 可在 `application.yml` 中配置CORS

```yaml
spring:
  web:
    cors:
      allowed-origins: "*"
      allowed-methods: "*"
      allowed-headers: "*"
```

## 📈 性能优化建议

### 1. 文件存储优化
- 使用CDN加速媒体文件访问
- 考虑使用云存储（阿里云OSS、腾讯云COS）
- 定期清理无用文件

### 2. 数据库优化
- 为常用查询字段添加索引
- 定期清理播放记录等日志数据
- 考虑读写分离

### 3. 缓存优化
- 热门媒体列表缓存
- 分类信息缓存
- 用户播放历史缓存

## 📞 技术支持

如遇到问题，请：
1. 查看日志文件：`logs/sys-info.log`
2. 检查数据库连接和表结构
3. 参考若依官方文档：http://doc.ruoyi.vip

---

**部署完成后，您的iOS应用就可以通过这些API接口进行音视频内容的管理和展示了！** 🎉